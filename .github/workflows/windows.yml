name: Windows

on: [push, pull_request]


jobs:
  setup_msbuild:
    runs-on: windows-latest

    steps:
    - name: setup msbuild
      uses: microsoft/setup-msbuild@v1.0.2


  setup_premake:
    runs-on: windows-latest

    steps:
    - name: download premake
      run: curl -OL premake.zip https://github.com/premake/premake-core/releases/download/v5.0.0-alpha15/premake-5.0.0-alpha15-windows.zip
    
    - name: unzip premake
      run: 7z x premake.zip -opremake


  checkout:
    runs-on: windows-latest
    needs: [setup_premake]

    steps:
    - name: checkout
      uses: actions/checkout@v1
      with:
        submodules: recursive

    - name: premake
      run: premake5.exe vs2019


  build_x64_debug:
    runs-on: windows-latest
    needs: [checkout, setup_msbuild]

    steps:
    - name: run msbuild
      run: MSBuild.exe project/qa_labs.sln -p:Configuration=Debug -p:Platform=x64


  build_x64_release:
    runs-on: windows-latest
    needs: [checkout, setup_msbuild]

    steps:
    - name: run msbuild
      run: MSBuild.exe project/qa_labs.sln -p:Configuration=Release -p:Platform=x64


  build_x86_debug:
    runs-on: windows-latest
    needs: [checkout, setup_msbuild]

    steps:
    - name: run msbuild
      run: MSBuild.exe project/qa_labs.sln -p:Configuration=Debug -p:Platform=x86


  build_x86_release:
    runs-on: windows-latest
    needs: [checkout, setup_msbuild]

    steps:
    - name: run msbuild
      run: MSBuild.exe project/qa_labs.sln -p:Configuration=Release -p:Platform=x86


  lab_1_test_x64_debug:
    runs-on: windows-latest
    needs: [build_x64_debug]

    steps:
    - name: run tests
      run: output/windows_x64_debug/lab_1_test.exe


  lab_1_test_x64_release:
    runs-on: windows-latest
    needs: [build_x64_release]

    steps:
    - name: run tests
      run: output/windows_x64_release/lab_1_test.exe
      

  lab_1_test_x86_debug:
    runs-on: windows-latest
    needs: [build_x86_debug]

    steps:
    - name: run tests
      run: output/windows_x86_debug/lab_1_test.exe


  lab_1_test_x86_release:
    runs-on: windows-latest
    needs: [build_x86_release]

    steps:
    - name: run tests
      run: output/windows_x86_release/lab_1_test.exe